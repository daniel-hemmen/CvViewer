<div class="explorer-container">
  <div class="explorer-header">
    <h2>CV Explorer</h2>
    <p>Selecteer een CV om details te bekijken</p>
  </div>

  <div class="explorer-content">
    <div class="tree-panel">
      <mat-tree [dataSource]="dataSource" [childrenAccessor]="childrenAccessor" class="cv-tree">
        <mat-nested-tree-node *matTreeNodeDef="let node">
          <div
            class="tree-node-row"
            (click)="onNodeClick(node, $event)"
            (dblclick)="$event.preventDefault(); $event.stopPropagation()"
          >
            @if (node.type === 'folder' && node.children && node.children.length > 0) {
            <button
              mat-icon-button
              (click)="toggleNode(node, $event)"
              [attr.aria-label]="'Toggle ' + node.name"
            >
              <mat-icon class="mat-icon-rtl-mirror">
                {{ treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right' }}
              </mat-icon>
            </button>
            } @else if (node.type === 'folder') {
            <span class="toggle-spacer" aria-hidden="true"></span>
            } @else {
            <button mat-icon-button disabled></button>
            }
            <mat-icon class="tree-icon">{{ getNodeIcon(node) }}</mat-icon>
            <span
              class="tree-node-label"
              [class.file-node]="node.type === 'file'"
              (mousedown)="$event.preventDefault()"
            >
              {{ node.name }}
              @if (node.type === 'folder' && node.name === 'Favorites' && (!node.children ||
              node.children.length === 0)) {
              <span class="folder-empty"> (empty)</span>
              }
            </span>
            @if (node.type === 'file') {
            <button
              mat-icon-button
              class="tree-fav-btn"
              aria-label="Toggle favorite"
              (click)="toggleFavoriteNode(node, $event)"
              title="Toggle favorite"
            >
              <mat-icon color="warn">{{
                isFavoriteById(node.id) ? 'favorite' : 'favorite_border'
              }}</mat-icon>
            </button>
            } @else {
            <span class="tree-fav-spacer"></span>
            }
          </div>
          @if (hasChild(0, node)) {
          <div [class.tree-invisible]="!treeControl.isExpanded(node)">
            <ng-container matTreeNodeOutlet></ng-container>
          </div>
          }
        </mat-nested-tree-node>
      </mat-tree>
    </div>

    <explorer-detail-view
      [details]="getCVDetails()"
      [isFavoriteById]="isFavoriteById.bind(this)"
      (toggleFavorite)="toggleFavoriteFromDetails($event)"
    ></explorer-detail-view>
  </div>
</div>
